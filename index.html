<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lista única por CNS</title>

<style>
body {font-family: Arial, sans-serif; margin: 20px;}
table {border-collapse: collapse; width: 100%; margin-top: 10px;}
th, td {border: 1px solid #ccc; padding: 6px; font-size: 14px;}
th {background: #f4f4f4;}
input[type="text"] {width: 95%; padding: 4px;}
button {padding: 6px 12px; margin: 5px; cursor: pointer;}
</style>

</head>
<body>

<h2>Lista única por CNS</h2>

<label>Selecione o arquivo CSV:
    <input type="file" id="csvFile" accept=".csv">
</label>

<div style="margin-top:10px;">
    <button onclick="copiarNomes()">Copiar nomes</button>
</div>

<table id="tabela">
    <thead>
        <tr>
            <th>CNS<br><input type="text" onkeyup="filtrar(0,this.value)"></th>
            <th>Nome<br><input type="text" onkeyup="filtrar(1,this.value)"></th>
            <th>Dt nasc.<br><input type="text" onkeyup="filtrar(2,this.value)"></th>
            <th>Dt agendamento<br><input type="text" onkeyup="filtrar(3,this.value)"></th>
            <th>Qtde exames<br><input type="text" onkeyup="filtrar(4,this.value)"></th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
function filtrar(col, termo) {
    const linhas = document.querySelectorAll("#tabela tbody tr");
    termo = termo.toLowerCase();
    linhas.forEach(linha => {
        const valor = linha.children[col].innerText.toLowerCase();
        linha.style.display = valor.includes(termo) ? "" : "none";
    });
}

document.getElementById("csvFile").addEventListener("change", function (e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (event) {
        const linhas = event.target.result.split(/\r?\n/);
        preencherTabela(linhas);
    };
    reader.readAsText(file, "UTF-8");
});

function preencherTabela(linhas) {
    const tbody = document.querySelector("#tabela tbody");
    tbody.innerHTML = "";

    linhas.forEach((linha, index) => {
        if (!linha.trim()) return;
        const col = linha.split(",");

        // evitar repetir cabeçalho no meio da lista
        if (index > 0 && col[0].toLowerCase().includes("cns")) return;

        const tr = document.createElement("tr");
        for (let i = 0; i < 5; i++) {
            const td = document.createElement("td");
            td.textContent = col[i] ? col[i].trim() : "";
            tr.appendChild(td);
        }
        tbody.appendChild(tr);
    });
}

function copiarNomes() {
    const linhas = document.querySelectorAll("#tabela tbody tr");
    let texto = "";

    linhas.forEach(linha => {
        const nome = linha.children[1].innerText.trim();
        if (nome) texto += nome + "\n";
    });

    navigator.clipboard.writeText(texto);
    alert("Nomes copiados!");
}
</script>

</body>
</html>
